{% extends "base.html" %}

{% block title %} Home {% endblock title%} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
{{ super() }}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
crossorigin=""/>
 <!-- Make sure you put this AFTER Leaflet's CSS -->
 <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>

<script>
  
  var myLat = {{image_latitude| tojson}};
  
</script>
{% endblock stylesheets %}

{% block content %}
<div class = "row">
  <div class="col-lg-12">
    <div class="card mb-3">
      <div class="card-header">
        <h4 class="card-title"> Welcome, {{current_user.username}}</h4>

      </div>

    </div>
    <div class="card">
      <div class="card-header">
        <h4 class="card-title"> End devices</h4>
      </div>
      <div class="card-body">
        
        <div class="table-responsive">
          <table class="table tablesorter fontsize-table " id="">
            <thead class=" text-primary">
              <tr>
                <th>
                  Name
                </th>
                <th>
                  Location
                </th>
                <th>
                  Last Seen [UTC+8]
                </th>

                <th>
                  Message
                </th>
                <th class="text-center">
                  Health
                </th>

              </tr>
            </thead>
            <tbody>
              {% set counter = namespace(value = 0) %}
              {% for name in devices_name %}
                <tr>
                  <td>
                    {{name}}
                  </td>
                  <td>
                    Latitude Longitude
                  </td>
            
                  <td>
                    {{devices_last_seen[counter.value]}}
                  </td>

                  <td>
                    {{devices_message[counter.value]}}
                  </td>

                  <td class="text-center">

                      {% if devices_status[counter.value] == "Offline" %}
                      <!-- <label for="progress_bar_offline">Offline</label>
                      <progress id="progress_bar_offline" value="100" max="100"> 100% </progress> -->
                      <li class="status_indicator bg-red mr-2"></li>Offline

                      {% else %}
                      <!-- <label for="progress_bar_online">Online</label>
                      <progress id="progress_bar_online" value="100" max="100"> 100% </progress> -->
                      <li class="status_indicator bg-green mr-2"></li>Online
                      {% endif %}
                     

                  </td>
                </tr>
                {% set counter.value = counter.value + 1 %}
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

</div>



<div class="row mt-3">
  
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-category">Aerial map</h5>
        <h3 class="card-title"><i class="tim-icons icon-bell-55 text-primary"></i> Elephant Radar</h3>
        <div id="mapid"></div>
      </div>
      
    </div>
  </div>
</div>

<div class="row">
  <button class = "btn" onclick="alert('Geocode: ' + myLat[0] + ' ' + myLat[1] + ' ' + myLat[2] + ' ' + myLat[20])" style = "height: 100px; width:200px;"/>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
{{ super() }}

<!--
  =======================================Leaflet Map API=======================================
-->
  <script>
    
    var mymap = L.map('mapid').setView([51.505, -0.09], 13);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox/streets-v11', //mapbox/satellite-v9
      tileSize: 512,
      zoomOffset: -1,
      accessToken: 'pk.eyJ1IjoiZHJpdmUxIiwiYSI6ImNrdXNsMmpyczB1cW8yd3FqNnNqaDB6dzcifQ.iLB9Fb5ExInw6SUIwCRnhQ'
    }).addTo(mymap);

    var marker = L.marker([1.818, 103.843]).addTo(mymap);
    var marker2 = L.marker([1.788, 103.928]).addTo(mymap);
    var marker3 = L.marker([1.863, 103.89]).addTo(mymap);
    var marker4 = L.marker([1.833, 103.951]).addTo(mymap);

    var site1_marker = L.marker([2.1228960, 103.4278710]).addTo(mymap);
    var site2_marker = L.marker([2.178698, 103.830802]).addTo(mymap);
    var site3_marker = L.marker([2.0609780, 103.8798060]).addTo(mymap);



    var circle = L.circle([1.833, 103.951], {
    color: 'red',
    fillColor: '#f03',
    fillOpacity: 0.5,
    radius: 500
}).addTo(mymap);
var polygon = L.polygon([
    [1.818, 103.843],
    [1.788, 103.928],
    [1.863, 103.89]
]).addTo(mymap);

marker.bindPopup("<b>Hello world!</b><br>I am {{current_user.username}}").openPopup();
marker2.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();
marker3.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();
marker4.bindPopup("<b>Hello world!</b><br>I am a popup.").openPopup();

site1_marker.bindPopup("<b>Feild trip site 1</b>").openPopup();
site2_marker.bindPopup("<b>Field trip site 2</b>").openPopup();
site3_marker.bindPopup("<b>Field trip site 3</b>").openPopup();

circle.bindPopup("I am a circle.");
polygon.bindPopup("I am a polygon.");
  </script>
  


{% endblock javascripts %}   
