{% extends "base.html" %}

{% block title %} Update Status {% endblock title%} 

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
{{ super() }}
{% endblock stylesheets %}

{% block content %}
<h1>Status Update</h1>
<p>This section is for users to upload relevant data collected either manually or through any related activity.</p>
<div class="row">
  <div class="col">
    <div class="col-md-8">
      <div class="card">
        <div class = "ml-3 mt-3">
          <h2>Image upload</h2>
    
          <p>
              {% with messages = get_flashed_messages() %}
                {% if messages %}
                  <ul>
                  {% for message in messages %}
                    <li>{{ message }}</li>
                  {% endfor %}
                  </ul>
                {% endif %}
              {% endwith %}
          </p>
          

        </div>

          {% if file_path %}
  
                  <img src="{{ "/" + file_path }}">
          {% endif %}
          <form method="POST" action="/data_center/update_status" enctype="multipart/form-data" autocomplete="off">
            <div class="form-group ml-3 ">
              <label for="exampleFormControlFile1">Choose image to upload <span style="color:red;">*</span></label>
              <input type="file" class="form-control-file" id="customFile" name = "file">
            </div>
              <!-- <dl>
                  <p>
                      <input type="file" name="file" class="form-control border border-white" autocomplete="off" required>
                  </p>
              </dl> -->
              <!-- <div class="custom-file">
                <input type="file" name="file" class="custom-file-input" id="customFile">
                <label class="custom-file-label" for="customFile">Choose file</label>
              </div> -->
              <div class = "form-group row ml-1">
                <label for="timstamp_input" class="col-sm-3 col-form-label">Image timestamp <span style="color:red;">*</span></label>
                <div class="col-sm-9">
                  <input style="max-width: 80%;" class="u-full-width" id="datetimepicker3" type="text" value="{{input_date_str}}" name="timestamp_input" required>
                </div> 
              </div>

              <div class = "form-group row ml-1">
                <label for="timstamp_input2" class="col-sm-3 col-form-label">Image timestamp 2 <span style="color:red;">*</span></label>
                <div class="col-sm-9">
                  <input style="max-width: 80%;" class="u-full-width" id="datetimepicker2" type="text"  name="timestamp_input2" required>
                </div> 
              </div>

              <div class="form-group row ml-1 mr-1">
                <label for="inputTag" class="col-sm-2 col-form-label">Tag / Remark</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="inputTag" placeholder="Image description in less than 100 characters" name = "img_tag_input">
                </div>
              </div>

              <div class="form-group row ml-1 mr-1">
                <label for="inputUploader" class="col-sm-2 col-form-label">Image uploader</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" id="inputUploader" placeholder="Uploader" value = "{{current_user.username}}"  name = "img_uploader" disabled>
                </div>
              </div>
              <fieldset class="form-group ml-3">
                <div class="row">
                  <legend class="col-form-label col-sm-2 pt-0">Image source</legend>
                  <div class="col-sm-10">
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="img_source" id="gridRadios1" value="uploaded" checked>
                      <label class="form-check-label" for="gridRadios1">
                        Uploaded (mobile phone, camera, etc)
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="img_source" id="gridRadios2" value="station 1">
                      <label class="form-check-label" for="gridRadios2">
                        Station 1
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="img_source" id="gridRadios3" value="station 2">
                      <label class="form-check-label" for="gridRadios3">
                        Station 2
                      </label>
                    </div>
                    <div class="form-check">
                      <input class="form-check-input" type="radio" name="img_source" id="gridRadios4" value="station 3">
                      <label class="form-check-label" for="gridRadios4">
                        Station 3
                      </label>
                    </div>

                    <div class="form-check disabled">
                      <input class="form-check-input" type="radio" name="img_source" id="gridRadios5" value="station 4" disabled>
                      <label class="form-check-label" for="gridRadios5">
                        Station 4
                      </label>
                    </div>

                  </div>
                </div>
              </fieldset>

              <div class = "form-group row ml-1">

                <label for="img_latitude" class="col-sm-2 col-form-label">Latitude:</label>
                <div class="col-sm-2">
                  <input type="number" id="img_latitude" name="img_latitude" min="-90" max="90">
                </div>

                <label for="img_longitude" class="col-sm-2 col-form-label">Longitude:</label>
                <div class="col-sm-2">
                  <input type="number" id="img_longitude" name="img_longitude" min="-180" max="180">
                </div>
              </div>

              <div class = "form-group row ml-3 mr-3">
                <p>Note: Latitude should be between -90 and 90, and longitude should be between -180 and 180</p>
              </div>

              <p>
                  <input type="submit" value="Submit" class="btn btn-info ml-3">
              </p>

          </form>
      </div>
    </div>

  </div>
</div>

{% endblock content %}
<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
{{ super() }}

<!-- Fetch jQuery -->
<script src="//code.jquery.com/jquery-3.5.0.min.js"></script>

<!-- Datetimepicker files start, copy from cdnjs.com (easier to maintain), instead of downloading -->
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.min.css"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-datetimepicker/2.5.20/jquery.datetimepicker.full.min.js"></script>

<!-- jstimezonedetect script start -->
<script src="//cdnjs.cloudflare.com/ajax/libs/jstimezonedetect/1.0.7/jstz.min.js" ></script>

<!--use Jquery function to attach datetime picker to 2 form fields & specify date format-->
<!--reference to from_date variable where python script will pass to template-->
<script>
jQuery( "#datetime_range" ).submit(function( event ) {
  timezone = jstz.determine();
  jQuery(".timezone").val(timezone.name());
});

jQuery('#datetimepicker3').datetimepicker({
  format:'Y-m-d H:i',
  theme: 'light',
  defaultDate:'{{input_date_str}}'
  });


  jQuery('#datetimepicker2').datetimepicker({
  format:'Y-m-d H:i',
  theme: 'light',
  defaultDate:'{{input_date_str}}'
  });

jQuery("#range_select input[type=radio]").click(function(){
  timezone = jstz.determine();
  jQuery(".timezone").val(timezone.name());
  jQuery(".station").val({{station}});
  jQuery("#range_select").submit();
  });
</script>
{% endblock javascripts %}   